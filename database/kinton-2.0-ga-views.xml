<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
<changeSet author="destevezg (generated)" id="1335522742615-197">
        <createView viewName="HOURLY_USAGE_MAX_VW">select `accounting_event_detail`.`startTime` AS `startTime`,`accounting_event_detail`.`endTime` AS `endTime`,`accounting_event_detail`.`idAccountingResourceType` AS `idAccountingResourceType`,`accounting_event_detail`.`resourceType` AS `resourceType`,`accounting_event_detail`.`resourceName` AS `resourceName`,max(`accounting_event_detail`.`resourceUnits`) AS `resourceUnits`,`accounting_event_detail`.`idEnterprise` AS `idEnterprise`,`accounting_event_detail`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`accounting_event_detail`.`idVirtualApp` AS `idVirtualApp`,`accounting_event_detail`.`idVirtualMachine` AS `idVirtualMachine`,`accounting_event_detail`.`enterpriseName` AS `enterpriseName`,`accounting_event_detail`.`virtualDataCenter` AS `virtualDataCenter`,`accounting_event_detail`.`virtualApp` AS `virtualApp`,`accounting_event_detail`.`virtualMachine` AS `virtualMachine` from `accounting_event_detail` group by `accounting_event_detail`.`startTime`,`accounting_event_detail`.`endTime`,`accounting_event_detail`.`idAccountingResourceType`,`accounting_event_detail`.`resourceType`,`accounting_event_detail`.`resourceName`,`accounting_event_detail`.`idEnterprise`,`accounting_event_detail`.`idVirtualDataCenter`,`accounting_event_detail`.`idVirtualApp`,`accounting_event_detail`.`idVirtualMachine`,`accounting_event_detail`.`enterpriseName`,`accounting_event_detail`.`virtualDataCenter`,`accounting_event_detail`.`virtualApp`,`accounting_event_detail`.`virtualMachine`</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-196">
        <createView viewName="DAILY_USAGE_SUM_VW">select cast(`v`.`startTime` as date) AS `startTime`,cast(`v`.`startTime` as date) AS `endTime`,`v`.`idAccountingResourceType` AS `idAccountingResourceType`,`v`.`resourceType` AS `resourceType`,sum(`v`.`resourceUnits`) AS `resourceUnits`,`v`.`idEnterprise` AS `idEnterprise`,`v`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`v`.`enterpriseName` AS `enterpriseName`,`v`.`virtualDataCenter` AS `virtualDataCenter` from `HOURLY_USAGE_MAX_VW` `v` group by cast(`v`.`startTime` as date),`v`.`idAccountingResourceType`,`v`.`resourceType`,`v`.`idEnterprise`,`v`.`idVirtualDataCenter`,`v`.`enterpriseName`,`v`.`virtualDataCenter`</createView>
    </changeSet>    
    <changeSet author="destevezg (generated)" id="1335522742615-198">
        <createView viewName="HOURLY_USAGE_SUM_VW">select `v`.`startTime` AS `startTime`,`v`.`endTime` AS `endTime`,`v`.`idAccountingResourceType` AS `idAccountingResourceType`,`v`.`resourceType` AS `resourceType`,sum(`v`.`resourceUnits`) AS `resourceUnits`,`v`.`idEnterprise` AS `idEnterprise`,`v`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`v`.`enterpriseName` AS `enterpriseName`,`v`.`virtualDataCenter` AS `virtualDataCenter` from `HOURLY_USAGE_MAX_VW` `v` group by `v`.`startTime`,`v`.`endTime`,`v`.`idAccountingResourceType`,`v`.`resourceType`,`v`.`idEnterprise`,`v`.`idVirtualDataCenter`,`v`.`enterpriseName`,`v`.`virtualDataCenter`</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-199">
        <createView viewName="LAST_HOUR_USAGE_IPS_VW">select `accounting_event_ips`.`idIPsAccountingEvent` AS `idIPsAccountingEvent`,`accounting_event_ips`.`idEnterprise` AS `idEnterprise`,`accounting_event_ips`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`accounting_event_ips`.`ip` AS `ip`,`accounting_event_ips`.`startTime` AS `startTime`,`accounting_event_ips`.`stopTime` AS `stopTime`,(unix_timestamp(`accounting_event_ips`.`stopTime`) - unix_timestamp(`accounting_event_ips`.`startTime`)) AS `DELTA_TIME`,from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600))) AS `ROUNDED_HOUR`,`virtualdatacenter`.`name` AS `VIRTUAL_DATACENTER`,`enterprise`.`name` AS `VIRTUAL_ENTERPRISE` from ((`accounting_event_ips` join `virtualdatacenter` on((`accounting_event_ips`.`idVirtualDataCenter` = `virtualdatacenter`.`idVirtualDataCenter`))) join `enterprise` on((`accounting_event_ips`.`idEnterprise` = `enterprise`.`idEnterprise`))) where (isnull(`accounting_event_ips`.`stopTime`) or ((`accounting_event_ips`.`stopTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_ips`.`stopTime`) - unix_timestamp(`accounting_event_ips`.`startTime`)) &gt; 3600)) or ((`accounting_event_ips`.`startTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_ips`.`stopTime`) - unix_timestamp(`accounting_event_ips`.`startTime`)) &lt;= 3600)))</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-200">
        <createView viewName="LAST_HOUR_USAGE_STORAGE_VW">select `accounting_event_storage`.`idStorageAccountingEvent` AS `idStorageAccountingEvent`,`accounting_event_storage`.`idVM` AS `idVM`,`accounting_event_storage`.`idEnterprise` AS `idEnterprise`,`accounting_event_storage`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`accounting_event_storage`.`idVirtualApp` AS `idVirtualApp`,`accounting_event_storage`.`idResource` AS `idResource`,`accounting_event_storage`.`resourceName` AS `resourceName`,`accounting_event_storage`.`idStorageTier` AS `idStorageTier`,`accounting_event_storage`.`sizeReserved` AS `sizeReserved`,`accounting_event_storage`.`startTime` AS `startTime`,`accounting_event_storage`.`stopTime` AS `stopTime`,(unix_timestamp(`accounting_event_storage`.`stopTime`) - unix_timestamp(`accounting_event_storage`.`startTime`)) AS `DELTA_TIME`,from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600))) AS `ROUNDED_HOUR`,`virtualdatacenter`.`name` AS `VIRTUAL_DATACENTER`,`enterprise`.`name` AS `VIRTUAL_ENTERPRISE` from ((`accounting_event_storage` join `virtualdatacenter` on((`accounting_event_storage`.`idVirtualDataCenter` = `virtualdatacenter`.`idVirtualDataCenter`))) join `enterprise` on((`accounting_event_storage`.`idEnterprise` = `enterprise`.`idEnterprise`))) where (isnull(`accounting_event_storage`.`stopTime`) or ((`accounting_event_storage`.`stopTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_storage`.`stopTime`) - unix_timestamp(`accounting_event_storage`.`startTime`)) &gt; 3600)) or ((`accounting_event_storage`.`startTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_storage`.`stopTime`) - unix_timestamp(`accounting_event_storage`.`startTime`)) &lt;= 3600)))</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-201">
        <createView viewName="LAST_HOUR_USAGE_VLAN_VW">select `accounting_event_vlan`.`idVLANAccountingEvent` AS `idVLANAccountingEvent`,`accounting_event_vlan`.`idEnterprise` AS `idEnterprise`,`accounting_event_vlan`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`accounting_event_vlan`.`network_name` AS `networkName`,`accounting_event_vlan`.`startTime` AS `startTime`,`accounting_event_vlan`.`stopTime` AS `stopTime`,(unix_timestamp(`accounting_event_vlan`.`stopTime`) - unix_timestamp(`accounting_event_vlan`.`startTime`)) AS `DELTA_TIME`,from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600))) AS `ROUNDED_HOUR`,`virtualdatacenter`.`name` AS `VIRTUAL_DATACENTER`,`enterprise`.`name` AS `VIRTUAL_ENTERPRISE` from ((`accounting_event_vlan` join `virtualdatacenter` on((`accounting_event_vlan`.`idVirtualDataCenter` = `virtualdatacenter`.`idVirtualDataCenter`))) join `enterprise` on((`accounting_event_vlan`.`idEnterprise` = `enterprise`.`idEnterprise`))) where (isnull(`accounting_event_vlan`.`stopTime`) or ((`accounting_event_vlan`.`stopTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_vlan`.`stopTime`) - unix_timestamp(`accounting_event_vlan`.`startTime`)) &gt; 3600)) or ((`accounting_event_vlan`.`startTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_vlan`.`stopTime`) - unix_timestamp(`accounting_event_vlan`.`startTime`)) &lt;= 3600)))</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-202">
        <createView viewName="LAST_HOUR_USAGE_VM_VW">select `accounting_event_vm`.`idVMAccountingEvent` AS `idVMAccountingEvent`,`accounting_event_vm`.`idVM` AS `idVM`,`accounting_event_vm`.`idEnterprise` AS `idEnterprise`,`accounting_event_vm`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`accounting_event_vm`.`idVirtualApp` AS `idVirtualApp`,`accounting_event_vm`.`cpu` AS `cpu`,`accounting_event_vm`.`ram` AS `ram`,`accounting_event_vm`.`hd` AS `hd`,`accounting_event_vm`.`startTime` AS `startTime`,`accounting_event_vm`.`stopTime` AS `stopTime`,`accounting_event_vm`.`costCode` AS `costCode`,`accounting_event_vm`.`hypervisorType` AS `hypervisorType`,(unix_timestamp(`accounting_event_vm`.`stopTime`) - unix_timestamp(`accounting_event_vm`.`startTime`)) AS `DELTA_TIME`,from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600))) AS `ROUNDED_HOUR`,concat(if(isnull(`virtualmachine`.`description`),'',substr(`virtualmachine`.`description`,1,120)),' - ',`virtualmachine`.`name`) AS `VIRTUAL_MACHINE`,`virtualapp`.`name` AS `VIRTUAL_APP`,`virtualdatacenter`.`name` AS `VIRTUAL_DATACENTER`,`enterprise`.`name` AS `VIRTUAL_ENTERPRISE` from ((((`accounting_event_vm` join `virtualmachine` on((`accounting_event_vm`.`idVM` = `virtualmachine`.`idVM`))) join `virtualapp` on((`accounting_event_vm`.`idVirtualApp` = `virtualapp`.`idVirtualApp`))) join `virtualdatacenter` on((`accounting_event_vm`.`idVirtualDataCenter` = `virtualdatacenter`.`idVirtualDataCenter`))) join `enterprise` on((`accounting_event_vm`.`idEnterprise` = `enterprise`.`idEnterprise`))) where (isnull(`accounting_event_vm`.`stopTime`) or ((`accounting_event_vm`.`stopTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_vm`.`stopTime`) - unix_timestamp(`accounting_event_vm`.`startTime`)) &gt; 3600)) or ((`accounting_event_vm`.`startTime` &gt; from_unixtime((-(3600) + (truncate((unix_timestamp(now()) / 3600),0) * 3600)))) and ((unix_timestamp(`accounting_event_vm`.`stopTime`) - unix_timestamp(`accounting_event_vm`.`startTime`)) &lt;= 3600)))</createView>
    </changeSet>
    <changeSet author="destevezg (generated)" id="1335522742615-203">
        <createView viewName="MONTHLY_USAGE_SUM_VW">select cast((`v`.`startTime` - interval (dayofmonth(`v`.`startTime`) - 1) day) as date) AS `startTime`,last_day(`v`.`startTime`) AS `endTime`,`v`.`idAccountingResourceType` AS `idAccountingResourceType`,`v`.`resourceType` AS `resourceType`,sum(`v`.`resourceUnits`) AS `resourceUnits`,`v`.`idEnterprise` AS `idEnterprise`,`v`.`idVirtualDataCenter` AS `idVirtualDataCenter`,`v`.`enterpriseName` AS `enterpriseName`,`v`.`virtualDataCenter` AS `virtualDataCenter` from `HOURLY_USAGE_MAX_VW` `v` group by cast((`v`.`startTime` - interval (dayofmonth(`v`.`startTime`) - 1) day) as date),`v`.`idAccountingResourceType`,`v`.`resourceType`,`v`.`idEnterprise`,`v`.`idVirtualDataCenter`,`v`.`enterpriseName`,`v`.`virtualDataCenter`</createView>
    </changeSet>
</databaseChangeLog>
